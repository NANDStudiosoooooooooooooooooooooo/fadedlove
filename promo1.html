<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Registrierung</title>
  <style>
    .hidden { display: none; }
    .visible { display: block; }
  </style>
</head>
<body>
  <h1>Registrierung</h1>
  <div>
    <label for="email">E-Mail:</label>
    <input type="email" id="email" placeholder="E-Mail eingeben" required>
  </div>
  <div id="usernameDiv" class="hidden">
    <label for="username">Benutzername:</label>
    <input type="text" id="username" placeholder="Benutzernamen eingeben" required>
  </div>
  <button id="submitBtn">Absenden</button>

  <div id="result"></div>

  <script>
    const submitBtn = document.getElementById('submitBtn');
    const emailInput = document.getElementById('email');
    const usernameDiv = document.getElementById('usernameDiv');
    const usernameInput = document.getElementById('username');
    const resultDiv = document.getElementById('result');

    submitBtn.addEventListener('click', async () => {
      const email = emailInput.value;
      const username = usernameInput.value;

      let url = new URL('https://fadedmarket.nand339.workers.dev/');
      url.searchParams.set('email', email);

      if (username) {
        url.searchParams.set('name', username);
      }

      const response = await fetch(url);
      const data = await response.json();

      if (data.status === 'NotRegistered') {
        // Benutzer ist nicht registriert, Name eingeben lassen
        usernameDiv.classList.remove('hidden');
        resultDiv.innerHTML = 'Bitte geben Sie einen Benutzernamen ein.';
      } else {
        // Benutzer existiert oder wurde gerade registriert
        usernameDiv.classList.add('hidden');
        resultDiv.innerHTML = `Name: ${data.name}, Score: ${data.score}`;
      }
    });
  </script>
</body>
</html>
