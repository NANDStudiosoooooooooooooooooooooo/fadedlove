<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FADEDCLOTH - GALLERY</title>
    <link href="https://fonts.googleapis.com/css?family=IBM+Plex+Sans:500|IBM+Plex+Sans:300&display=swap" rel="stylesheet">
    <meta name="description" content="The offical FADEDCLOTH shop. Subscribe for updates.">
    <link rel="stylesheet" href="styles/main.css?v=2.73">

    <style>
        body{
            overflow: hidden;
            align-items: center;
        }

        .gallery-imagebutton-container::-webkit-scrollbar-track {
        background: transparent; /* Transparent scrollbar track */
        }

        /* Removes arrows from the scrollbars in Webkit browsers (Chrome, Safari) */
        .gallery-imagebutton-container::-webkit-scrollbar-button {
        display: none; /* Hides the up/down or left/right arrow buttons */
        }

        /* Ensures the active button is always visible */
        .gallery-imagebutton-container button.active-image-button {
        scroll-margin-left: 10px; /* Ensures active button is smoothly scrolled into view */
        }

        .gallery-imagebutton-container::-webkit-scrollbar-thumb {
        border-radius: 0;
        }

        .gallery-container {
        width: 100%;
        max-width: 450px;
        display: flex;
        flex-direction: column;
        align-items: center;
        z-index: 6900;
        }

        .gallery-headline {
        text-align: center;
        font-size: 2rem;
        margin-bottom: 10px;
        color: white;
        }

        .gallery-headline a {
        text-decoration: none;
        color: inherit;
        }

        .gallery-image-container {
        width: 100%;
        max-width: 100%;
        height: auto;
        overflow: visible;
        position: relative;
        margin-bottom: 10px;
        }

        @media (max-width: 500px) {
            .gallery-container{
                max-width: 100%;
            }
            @media (max-height: 780px) {
                .gallery-container{
                    max-width: auto;
                    max-height: calc(100% - 150px);
                }
            }
        }
        @media (max-height: 780px) {
                .gallery-container{
                    max-width: auto;
                    max-height: calc(100% - 150px);
                }
            }
        

        .gallery-image-container img {
        width: 100%;
        height: auto;
        object-fit: cover;
        transition: opacity 0.5s ease;
        }

        .gallery-imagebutton-container {
        display: flex;
        max-width: 100%;
        overflow: hidden;
        scrollbar-width: none;
        scrollbar-color: rgba(255, 255, 255, 0.2) transparent; 
        scroll-snap-type: x mandatory; /* Buttons will snap into view when scrolling */
        }

        .gallery-imagebutton-container button {
        flex: 0 0 auto; /* Prevent buttons from shrinking */
        margin-right: 10px; /* Optional: Space between buttons */
        }

        /* For Webkit-based browsers like Chrome */
        .gallery-imagebutton-container::-webkit-scrollbar {
        height: 8px; /* Set the height of the horizontal scrollbar */
        }

        .gallery-imagebutton-container::-webkit-scrollbar-thumb {
        background-color: rgba(255, 255, 255, 0.2); /* Dezent transparent scrollbar thumb */
        border-radius: 10px; /* Rounded corners for the scrollbar */
        }

        .gallery-imagebutton-container::-webkit-scrollbar-track {
        background: transparent; /* Transparent scrollbar track */
        }

        /* Ensures the active button is always visible */
        .gallery-imagebutton-container button.active-image-button {
        scroll-margin-left: 10px; /* Ensures active button is smoothly scrolled into view */
        }


        .gallery-imagebutton-container button {
        border: none;
        background: none;
        margin-right: 10px;
        cursor: pointer;
        transition: transform 0.3s;
        }

        .gallery-imagebutton-container button img {
        width: 50px;
        height: 50px;
        object-fit: cover;
        }

        .gallery-imagebutton-container::-webkit-scrollbar {
        height: 5px;
        }

        .gallery-imagebutton-container::-webkit-scrollbar-thumb {
        background: #888;
        border-radius: 10px;
        }

        .gallery-imagebutton-container::-webkit-scrollbar-thumb:hover {
        background: #555;
        }

        .active-image-button{
            /*box-shadow: 0 0 4px 2px rgba(255, 255, 255, 0.5);*/
        }

    </style>
</head>
<body>
    
        <div class="main-header">
            
            <div class="text-box top-left"><a href="https://fadedcloth.de">fadedcloth.de</a><a href="https://fadedcloth.de/gallery">/gallery</a></div>
    
            <div class="header-logo-container" id="load-container">
                <video autoplay loop muted playsinline class="header-logo top" id="load-obj">
                    
                    <source src="https://cdn.shopify.com/videos/c/o/v/98309ce66f8641dea5e579d4f1a8a4d9.mp4" type="video/mp4">
                    <source src="https://cdn.shopify.com/videos/c/o/v/696856536feb451699e4337ac233c8a9.webm" type="video/webm">
                    Your browser does not support the video tag.
                </video>
            </div>
            <div id="loader" class="loader-container">
                <l-zoomies size="80" stroke="5" bg-opacity="0.1" speed="1.4" color="white"></l-zoomies>
              </div>
        </div>
    
        <div class="gallery-container fade-in">
            <div class="gallery-headline"> 

            </div>
  
            <div class="gallery-image-container" data-tilt>
                  
            </div>
          
            <div class="gallery-imagebutton-container"> 
                  
            </div>

        </div>
    
        <div class="buttons-container">
            <button id="button1" class="glass-button" data-target="panel1">COLLECTION</button>
            <button id="button2" class="glass-button" data-target="panel2">INFO</button>
            <button id="button3" class="glass-button" data-target="panel3">NEWSLETTER</button>
            <!--<button id="button4" class="glass-button" data-target="panel4">SMS</button>-->
        </div>
        
        <!-- Panel für Button 1 -->
        <div id="panel1" class="glass-panel hidden">
            <button class="close-btn" onclick="togglePanel('panel1')">X</button>
            <a href="https://fadedcloth.de/gallery" class="panel-link">GALLERY</a>
            <a href="https://fadedcloth.de/" class="panel-link">MAINPAGE</a>
        </div>
        
        <!-- Panel für Button 2 -->
        <div id="panel2" class="glass-panel hidden">
            <button class="close-btn" onclick="togglePanel('panel2')">X</button>
            <div class="social-container">
                <select id="social-select">
                    <option value="instagram">INSTAGRAM</option>
                    <option value="tiktok">TIKTOK</option>
                    <option value="twitter">TWITTER</option>
                </select>
                <a class="underlineonhover" id="social-select-link" href="https://instagram.com/fadedcloth.de">fadedcloth.de</a>
            </div>
            <a href="mailto:help@fadedcloth.de" class="panel-link">CONTACT</a>
            <a href="https://fadedcloth.de/legal?id=privacy-policy" class="panel-link">PRIVACY POLICY</a>
            <a href="https://fadedcloth.de/legal?id=terms-of-service" class="panel-link">TERMS OF SERVICE</a>
            <div class="copyright">&copy; FADEDCLOTH 2024</div>
        </div>
        
        <!-- Panel für Button 3 (Subscribe Panel) -->
        <div id="panel3" class="glass-panel hidden">
            <button class="close-btn" onclick="togglePanel('panel3')">X</button>
            <div class="headline">SUBSCRIBE FOR UPDATES</div>
            <form id="emailForm">
                <input 
                    type="email" 
                    id="email" 
                    placeholder="ENTER YOUR EMAIL" 
                    class="email-input"
                    required 
                />
                <div class="checkbox-container">
                    <input type="checkbox" id="termsCheckbox" class="custom-checkbox">
                    <label for="termsCheckbox" class="checkbox-label">
                      I ACCEPT THE <a class="href" href="https://fadedcloth.de/legal?id=terms-of-service">TERMS</a>
                    </label>
                </div>
                <div class="form-buttons">
                    <button id="subscribeButton" class="email-button small-button">
                        SUBMIT
                    </button>
                </div>
            </form>
        </div>

    <script src="scripts/loader.js" defer></script>
    <script src="scripts/vanilla-tilt.js"></script>
    <script src="scripts/animate.js" defer></script> 
    <script src="scripts/social.js?v=1.2" defer></script>
    <script src="scripts/load-buttons.js?v=1.47" defer></script>
    <script type="module" src="https://cdn.jsdelivr.net/npm/ldrs/dist/auto/zoomies.js" defer></script>
    <script src="scripts/subscribe.js" defer></script>

    <script>
       document.addEventListener('DOMContentLoaded', async () => { 
    const imageContainer = document.querySelector('.gallery-image-container');
    const headlineContainer = document.querySelector('.gallery-headline');
    const buttonContainer = document.querySelector('.gallery-imagebutton-container');

    let currentImageIndex = 0;

    // Funktion zum Aktualisieren der Galerie
    function updateGallery(index, posts) {
        const selectedPost = posts[index];
        const imageUrl = selectedPost.image;
        const postTitle = selectedPost.title;
        const postLink = selectedPost.link;

        // Update image
        imageContainer.innerHTML = `<img src="${imageUrl}" class="fade-in">`;

        // Remove and re-add fade-in class
        const imageElement = imageContainer.querySelector('img');
        imageElement.classList.remove('fade-in');
        void imageElement.offsetWidth; // Force reflow for animation reset
        imageElement.classList.add('fade-in');

        // Update headline
        headlineContainer.innerHTML = postLink
            ? `<a href="${postLink}" class="headline">${postTitle}</a>`
            : `<span class="headline">${postTitle}</span>`;

        // Update button class
        document.querySelectorAll('.gallery-imagebutton-container button').forEach((btn, idx) => {
            btn.classList.toggle('soft-shake', idx === index);
            btn.classList.toggle('active-image-button', idx === index);
        });

        // Scroll to button if necessary
        const selectedButton = buttonContainer.children[index];
        selectedButton.scrollIntoView({ behavior: 'smooth', inline: 'center' });
    }

    // Funktion zum Laden der Blog-Daten aus Shopify
    async function loadGalleryData() {
        const query = `{
            blog(handle: "gallery") {
                articles(first: 100) {
                    edges {
                        node {
                            title
                            image {
                                src
                            }
                            metafields(identifiers: [
                                {namespace: "gallery", key: "product"},
                                {namespace: "gallery", key: "collection"}
                            ]) {
                                namespace
                                key
                                value
                            }
                        }
                    }
                }
            }
        }`;

        try {
            const response = await fetch("https://checkout.fadedcloth.de/api/2023-07/graphql.json", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                    "X-Shopify-Storefront-Access-Token": "ed72f09d8742f37356305b6e49310909"
                },
                body: JSON.stringify({ query })
            });

            if (!response.ok) throw new Error(`HTTP error! Status: ${response.status}`);

            const data = await response.json();
            let posts = data.data.blog.articles.edges.map(edge => {
                const article = edge.node;
                const image = article.image?.src || '';
                const metafields = article.metafields || [];

                // Sicherstellen, dass die Metafelder vorhanden sind und nicht leer
                const productId = metafields?.find(
                    metafield => metafield?.namespace === "gallery" && metafield?.key === "product"
                )?.value?.match(/gid:\/\/shopify\/Product\/(\d+)/)?.[1] || null;

                const collectionId = metafields?.find(
                    metafield => metafield?.namespace === "gallery" && metafield?.key === "collection"
                )?.value?.match(/gid:\/\/shopify\/Collection\/(\d+)/)?.[1] || null;

                // Bestimmen des Links basierend auf den Metafeldern
                let link = null;
                if (productId) {
                    link = `https://shop.fadedcloth.de/item?item_id=${productId}`;
                } else if (collectionId) {
                    link = `https://shop.fadedcloth.de?collection_id=${collectionId}&hide=TRUE`;
                }

                // Rückgabe des Posts mit Link
                return {
                    title: article.title,
                    image: image,
                    link: link
                };
            });

            // Posts umdrehen, damit der neueste Post am Anfang kommt
            posts.reverse();

            // Buttons dynamisch laden
            posts.forEach((post, index) => {
                const button = document.createElement('button');
                button.innerHTML = `<img src="${post.image}" alt="${post.title}">`;
                button.addEventListener('click', () => {
                    currentImageIndex = index;
                    updateGallery(index, posts);
                });
                buttonContainer.appendChild(button);
            });

            // Initial mit dem ersten Post starten
            if (posts.length > 0) {
                updateGallery(0, posts);
            }

            // Swipe events für mobile
            let touchStartX = 0;
            imageContainer.addEventListener('touchstart', (e) => {
                touchStartX = e.touches[0].clientX;
            });

            imageContainer.addEventListener('touchend', (e) => {
                const touchEndX = e.changedTouches[0].clientX;
                if (touchEndX < touchStartX - 50) {
                    currentImageIndex = (currentImageIndex + 1) % posts.length;
                    updateGallery(currentImageIndex, posts);
                } else if (touchEndX > touchStartX + 50) {
                    currentImageIndex = (currentImageIndex - 1 + posts.length) % posts.length;
                    updateGallery(currentImageIndex, posts);
                }
            });

            // Scroll event für PC
            imageContainer.addEventListener('wheel', (e) => {
                if (e.deltaY > 0) {
                    currentImageIndex = (currentImageIndex + 1) % posts.length;
                } else {
                    currentImageIndex = (currentImageIndex - 1 + posts.length) % posts.length;
                }
                updateGallery(currentImageIndex, posts);
            });
        } catch (error) {
            console.error("Error loading gallery data:", error);
        }
    }

    // Galerie-Daten laden
    await loadGalleryData();
});



    </script>
    
</body>
</html>